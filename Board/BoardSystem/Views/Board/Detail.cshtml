@using Microsoft.AspNetCore.Http
@model BoardSystem.Models.Board

<div class="row">
    <div class="col-lg-12" id="title">
        
    </div>
</div>

<div class="row">
    <div class="col-lg-10">
        <div class="panel panel-default" id="board">


        </div>
        @if (Context.Session.GetString("USER_LOGIN_KEY").Equals(@Model.UserId) || Context.Session.GetString("USER_LOGIN_KEY").Equals("root"))
        {
            <div class="panel-footer">
                <a class="btn btn-primary" asp-controller="Board" asp-action="Delete" asp-route-boardNum="@Model.BoardNum">削除</a>
            </div>
        }
    </div>
</div>
<div class="row">
    <div class="col-lg-10">
        <form class="form-horizontal" method="post" action="AddComment">
            <div class="form-group">
                <table>
                    <tr><th>
    <textarea class="form-control" name="CommentContents" id="CommentContents" placeholder="内容入力"></textarea>
    <span class="text-danger"></span>
</th>
                    <th><button type="submit" class="btn btn-primary">コメント入力</button></th></tr>
                </table>
                
                <input type="hidden" name="UserId" value="@Context.Session.GetString("USER_LOGIN_KEY")" />
                <input type="hidden" name="BoardNum" value="@Model.BoardNum" />
            </div>
            <div class="form-group">
                
            </div>
        </form>
    </div>
    <table class="table table-bordered" id="commentTable">
        <tr>
            <th>ユーザー</th>
            <th>コメント</th>
            <th>日付</th>
            <th></th>
        </tr>
         
    </table>

</div>
<script>
    var boardContents;
    frmUrl = location.href;
    varCut = frmUrl.indexOf("?");
    varCheck = frmUrl.substring(varCut + 1);
    var varList = varCheck.split("&");
    forCount = varList.length;
    for (i = 0; i < forCount; i++) {
        eval(varList[i]);
    }
    alert(boardNum);
    $(window).load(function () {
        $.ajax({
            type: "get",
            dataType: "json",
            url: "http://localhost:1455/api/BoardContents?boardNum=" + boardNum,
            success: function (result) {
                $("#board").append('<div class="panel-heading" >題目：' + result.BoardTitle + '</div>' +
                    '<div class="panel-heading">ユーザー：' + result.UserId + '</div>' +
                    '<div class="panel-heading">日付：' + result.BoardDate + '</div>' +
                    '<div class="panel-heading">アクセス数：' + result.BoardViews + '</div>' +
                    '<div class="panel-body">' + result.BoardContents + '</div>'
                );
                $("#title").append('<h3 class="page-header" >題目 -' + result.BoardTitle +' </h3>');
            }
        });
    });
</script>
<script>
    $(window).load(function () {
        $.ajax({
            type: "get",
            dataType: "json",
            url: "http://localhost:1455/api/Comments?boardNum=" + boardNum,
            success: function (result) {
                $.each(result, function (index, item) {
                    console.log(item);
                    $("#commentTable").append('<tr>' +
                        '<td>' + item.UserId + '</td>' +
                        '<td>' + item.CommentContents + '</td>' +
                        '<td>' + item.CommentDate + '</td>' +
                        '<td></td>' +
                        '</tr>');

                });
            }
        });
    });
</script>
